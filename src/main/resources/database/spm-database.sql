-- MySQL Script generated by MySQL Workbench
-- Tue Apr  2 16:31:02 2019
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema spm
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `spm` ;

-- -----------------------------------------------------
-- Schema spm
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `spm` DEFAULT CHARACTER SET utf8 ;
USE `spm` ;

-- -----------------------------------------------------
-- Table `spm`.`user_info`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`user_info` ;

CREATE TABLE IF NOT EXISTS `spm`.`user_info` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `username` CHAR(10) NOT NULL,
  `password` VARCHAR(32) NOT NULL,
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `role` VARCHAR(32) NOT NULL,
  `realname` VARCHAR(64) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));


-- -----------------------------------------------------
-- Table `spm`.`student`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`student` ;

CREATE TABLE IF NOT EXISTS `spm`.`student` (
  `user_id` INT UNSIGNED NOT NULL,
  `nickname` VARCHAR(128) NULL,
  `grade` VARCHAR(16) NULL,
  `college` VARCHAR(128) NULL,
  PRIMARY KEY (`user_id`),
  CONSTRAINT `fk_student_userinfo`
    FOREIGN KEY (`user_id`)
    REFERENCES `spm`.`user_info` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`teacher`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`teacher` ;

CREATE TABLE IF NOT EXISTS `spm`.`teacher` (
  `user_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`user_id`),
  CONSTRAINT `fk_teacher_userinfo`
    FOREIGN KEY (`user_id`)
    REFERENCES `spm`.`user_info` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`course`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`course` ;

CREATE TABLE IF NOT EXISTS `spm`.`course` (
  `course_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `teacher_id` INT UNSIGNED NOT NULL,
  `course_name` VARCHAR(128) NOT NULL,
  `description` TEXT NOT NULL,
  `period` TINYINT NOT NULL,
  `start_time` DATE NOT NULL,
  `finish_time` DATE NOT NULL,
  PRIMARY KEY (`course_id`),
  INDEX `fk_course_teacher_idx` (`teacher_id` ASC),
  CONSTRAINT `fk_course_teacher`
    FOREIGN KEY (`teacher_id`)
    REFERENCES `spm`.`teacher` (`user_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`experiment`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`experiment` ;

CREATE TABLE IF NOT EXISTS `spm`.`experiment` (
  `experiment_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `experiment_name` VARCHAR(256) NOT NULL,
  `description` TEXT NULL,
  `start_time` DATE NOT NULL,
  `finish_time` DATE NOT NULL,
  `course_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`experiment_id`),
  INDEX `fk_experiment_course_idx` (`course_id` ASC),
  CONSTRAINT `fk_experiment_course`
    FOREIGN KEY (`course_id`)
    REFERENCES `spm`.`course` (`course_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`selected_course`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`selected_course` ;

CREATE TABLE IF NOT EXISTS `spm`.`selected_course` (
  `student_user_id` INT UNSIGNED NOT NULL,
  `course_course_id` INT UNSIGNED NOT NULL,
  `approve_time` DATETIME NOT NULL,
  `avg_online_score` DECIMAL(5,1) NULL,
  `mid_score` DECIMAL(5,1) NULL,
  `final_score` DECIMAL(5,1) NULL,
  `total_score` DECIMAL(5,1) NULL,
  PRIMARY KEY (`student_user_id`, `course_course_id`),
  INDEX `fk_student_has_course_course2_idx` (`course_course_id` ASC),
  INDEX `fk_student_has_course_student2_idx` (`student_user_id` ASC),
  CONSTRAINT `fk_student_has_course_student2`
    FOREIGN KEY (`student_user_id`)
    REFERENCES `spm`.`student` (`user_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_student_has_course_course2`
    FOREIGN KEY (`course_course_id`)
    REFERENCES `spm`.`course` (`course_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`chapter`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`chapter` ;

CREATE TABLE IF NOT EXISTS `spm`.`chapter` (
  `chapter_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `course_id` INT UNSIGNED NOT NULL,
  `sequence` TINYINT UNSIGNED NOT NULL,
  `chapter_name` VARCHAR(256) NOT NULL,
  PRIMARY KEY (`chapter_id`),
  INDEX `fk_chapter_couser_idx` (`course_id` ASC),
  CONSTRAINT `fk_chapter_couser`
    FOREIGN KEY (`course_id`)
    REFERENCES `spm`.`course` (`course_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`filesource`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`filesource` ;

CREATE TABLE IF NOT EXISTS `spm`.`filesource` (
  `filesouce_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `filename` VARCHAR(256) NOT NULL,
  `identifier` VARCHAR(256) NOT NULL,
  `filetype` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`filesouce_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`section`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`section` ;

CREATE TABLE IF NOT EXISTS `spm`.`section` (
  `section_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `chapter_id` INT UNSIGNED NOT NULL,
  `sequence` TINYINT NOT NULL,
  `section_name` VARCHAR(256) NOT NULL,
  PRIMARY KEY (`section_id`),
  INDEX `fk_section_chapter_idx` (`chapter_id` ASC),
  CONSTRAINT `fk_section_chapter`
    FOREIGN KEY (`chapter_id`)
    REFERENCES `spm`.`chapter` (`chapter_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`experiment_file`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`experiment_file` ;

CREATE TABLE IF NOT EXISTS `spm`.`experiment_file` (
  `experiment_experiment_id` INT UNSIGNED NOT NULL,
  `filesource_filesouce_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`experiment_experiment_id`, `filesource_filesouce_id`),
  INDEX `fk_experiment_has_filesource_filesource1_idx` (`filesource_filesouce_id` ASC),
  INDEX `fk_experiment_has_filesource_experiment1_idx` (`experiment_experiment_id` ASC),
  CONSTRAINT `fk_experiment_has_filesource_experiment1`
    FOREIGN KEY (`experiment_experiment_id`)
    REFERENCES `spm`.`experiment` (`experiment_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_experiment_has_filesource_filesource1`
    FOREIGN KEY (`filesource_filesouce_id`)
    REFERENCES `spm`.`filesource` (`filesouce_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`section_file`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`section_file` ;

CREATE TABLE IF NOT EXISTS `spm`.`section_file` (
  `section_section_id` INT UNSIGNED NOT NULL,
  `filesource_filesouce_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`section_section_id`, `filesource_filesouce_id`),
  INDEX `fk_section_has_filesource_filesource1_idx` (`filesource_filesouce_id` ASC),
  INDEX `fk_section_has_filesource_section1_idx` (`section_section_id` ASC),
  CONSTRAINT `fk_section_has_filesource_section1`
    FOREIGN KEY (`section_section_id`)
    REFERENCES `spm`.`section` (`section_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_section_has_filesource_filesource1`
    FOREIGN KEY (`filesource_filesouce_id`)
    REFERENCES `spm`.`filesource` (`filesouce_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`student_course_experiment`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`student_course_experiment` ;

CREATE TABLE IF NOT EXISTS `spm`.`student_course_experiment` (
  `student_id` INT UNSIGNED NOT NULL,
  `course_id` INT UNSIGNED NOT NULL,
  `experiment_experiment_id` INT UNSIGNED NOT NULL,
  `doc_file` INT UNSIGNED NOT NULL,
  `vedio_file` INT UNSIGNED NOT NULL,
  `score` INT UNSIGNED NULL,
  PRIMARY KEY (`student_id`, `course_id`, `experiment_experiment_id`),
  INDEX `fk_student_course_approve_has_experiment1_experiment1_idx` (`experiment_experiment_id` ASC),
  INDEX `fk_student_course_approve_has_experiment1_student_course_ap_idx` (`student_id` ASC, `course_id` ASC),
  INDEX `fk_stu_course_exp_file_idx` (`doc_file` ASC),
  INDEX `fk_stu_course_exp_file2_idx` (`vedio_file` ASC),
  CONSTRAINT `fk_student_course_approve_has_experiment1_student_course_appr1`
    FOREIGN KEY (`student_id` , `course_id`)
    REFERENCES `spm`.`selected_course` (`student_user_id` , `course_course_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_student_course_approve_has_experiment1_experiment1`
    FOREIGN KEY (`experiment_experiment_id`)
    REFERENCES `spm`.`experiment` (`experiment_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_stu_course_exp_file`
    FOREIGN KEY (`doc_file`)
    REFERENCES `spm`.`filesource` (`filesouce_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_stu_course_exp_file2`
    FOREIGN KEY (`vedio_file`)
    REFERENCES `spm`.`filesource` (`filesouce_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`exam`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`exam` ;

CREATE TABLE IF NOT EXISTS `spm`.`exam` (
  `exam_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `chapter_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`exam_id`),
  INDEX `fk_exam_chapter_idx` (`chapter_id` ASC),
  CONSTRAINT `fk_exam_chapter`
    FOREIGN KEY (`chapter_id`)
    REFERENCES `spm`.`chapter` (`chapter_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`option`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`option` ;

CREATE TABLE IF NOT EXISTS `spm`.`option` (
  `option_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `option_detail` VARCHAR(256) NOT NULL,
  `question_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`option_id`),
  INDEX `fk_question_option_idx` (`question_id` ASC),
  CONSTRAINT `fk_question_option`
    FOREIGN KEY (`question_id`)
    REFERENCES `spm`.`question` (`question_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`question`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`question` ;

CREATE TABLE IF NOT EXISTS `spm`.`question` (
  `question_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `exam` INT UNSIGNED NOT NULL,
  `answer` INT UNSIGNED NOT NULL,
  `detail` TEXT NOT NULL,
  PRIMARY KEY (`question_id`),
  INDEX `fk_exam_question_idx` (`exam` ASC),
  INDEX `fk_question_answer_idx` (`answer` ASC),
  UNIQUE INDEX `answer_UNIQUE` (`answer` ASC),
  CONSTRAINT `fk_exam_question`
    FOREIGN KEY (`exam`)
    REFERENCES `spm`.`exam` (`exam_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_question_answer`
    FOREIGN KEY (`answer`)
    REFERENCES `spm`.`option` (`option_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`notice`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`notice` ;

CREATE TABLE IF NOT EXISTS `spm`.`notice` (
  `notice_id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `author` INT UNSIGNED NOT NULL,
  `title` VARCHAR(128) NOT NULL,
  `detail` TEXT NOT NULL,
  `date_create` DATETIME NOT NULL,
  PRIMARY KEY (`notice_id`),
  INDEX `fk_notiece_author_idx` (`author` ASC),
  CONSTRAINT `fk_notiece_author`
    FOREIGN KEY (`author`)
    REFERENCES `spm`.`teacher` (`user_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `spm`.`message`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `spm`.`message` ;

CREATE TABLE IF NOT EXISTS `spm`.`message` (
  `message_id` INT UNSIGNED NOT NULL,
  `author` INT UNSIGNED NOT NULL,
  `content` TEXT NOT NULL,
  `create_time` DATETIME NOT NULL,
  `reply_to` INT UNSIGNED NULL,
  PRIMARY KEY (`message_id`),
  INDEX `fk_message_reply_idx` (`reply_to` ASC),
  INDEX `fk_message_author_idx` (`author` ASC),
  CONSTRAINT `fk_message_reply`
    FOREIGN KEY (`reply_to`)
    REFERENCES `spm`.`message` (`message_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_message_author`
    FOREIGN KEY (`author`)
    REFERENCES `spm`.`user_info` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
